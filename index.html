<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Selfie AR - Vivari Beach Club</title>
<script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>
<style>
  body { margin:0; background:#000; overflow:hidden; font-family:Arial,sans-serif; }
  #cameraVideo {
    position:fixed; top:0; left:0; width:100vw; height:100vh;
    object-fit:cover; z-index:0;
    pointer-events:none;
  }
  #modelContainer {
    position:fixed; top:0; left:0; width:100vw; height:100vh;
    z-index:1;
  }
  model-viewer {
    width:70%; height:70%;
    position:absolute; top:15%; left:15%;
    pointer-events:auto;
  }
  #controls {
    position:absolute; bottom:20px; left:50%; transform:translateX(-50%);
    display:flex; gap:15px;
    z-index:10;
  }
  .btn {
    padding:24px 34px;
    border:none; border-radius:20px;
    background:#0b84ff; color:#fff; font-weight:bold; font-size:24px;
    cursor:pointer; box-shadow:0 6px 12px rgba(0,0,0,0.4);
  }
  #rotateHint {
    position:absolute; bottom:110px; left:50%; transform:translateX(-50%);
    z-index:10;
    color:#fff; font-size:18px; font-weight:bold;
    background:rgba(0,0,0,0.4); padding:8px 12px; border-radius:8px;
  }
  @media (max-width:600px) {
    .btn { padding:34px 46px; font-size:28px; }
    #rotateHint { font-size:16px; bottom:130px; }
  }
</style>
</head>
<body>

<video id="cameraVideo" autoplay playsinline muted></video>

<div id="modelContainer">
     <model-viewer id="model" src="vivi.glb"
              alt="Vivi 3D"
              camera-controls
              environment-image="neutral"
              shadow-intensity="1"
              field-of-view="65deg"
              camera-orbit="0deg 90deg 4m"
              camera-target="0m 0.5m 0m">
     </model-viewer>
</div>

<div id="rotateHint">‚¨ÖÔ∏è Arraste ou mova o celular para girar a Vivi ‚û°Ô∏è</div>

<div id="controls">
  <button id="switchCamBtn" class="btn">üîÑ Trocar C√¢mera</button>
  <button id="captureBtn" class="btn">üì∏ Tirar Foto</button>
</div>

<script>
  const video = document.getElementById('cameraVideo');
  let useFrontCamera = true;
  let currentStream;

  async function startCamera() {
    if (currentStream) {
      currentStream.getTracks().forEach(track => track.stop());
    }
    try {
      currentStream = await navigator.mediaDevices.getUserMedia({
        video: { facingMode: useFrontCamera ? "user" : "environment" }
      });
      video.srcObject = currentStream;
      video.style.transform = useFrontCamera ? "scaleX(-1)" : "scaleX(1)";
    } catch (err) {
      alert("Erro ao acessar c√¢mera: " + err);
    }
  }

  document.getElementById('switchCamBtn').addEventListener('click', () => {
    useFrontCamera = !useFrontCamera;
    startCamera();
  });

  const captureBtn = document.getElementById('captureBtn');
  const modelViewer = document.getElementById('model');

  captureBtn.addEventListener('click', async () => {
    try {
      // snapshot da Vivi
      const modelSnapshot = await modelViewer.toDataURL();

      // canvas final
      const canvas = document.createElement('canvas');
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
      const ctx = canvas.getContext('2d');

      // desenha v√≠deo
      if (useFrontCamera) {
        ctx.translate(canvas.width, 0);
        ctx.scale(-1, 1);
      }
      ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

      ctx.setTransform(1,0,0,1,0,0);

      // desenha Vivi
      const imgModel = new Image();
      imgModel.onload = () => {
        ctx.drawImage(imgModel, canvas.width*0.15, canvas.height*0.15, canvas.width*0.7, canvas.height*0.7);

        // marca d‚Äô√°gua
        ctx.font = `${Math.floor(canvas.height/18)}px Arial Black`;
        ctx.fillStyle = "rgba(255,255,255,0.7)";
        ctx.textAlign = "center";
        ctx.fillText("Vivari Beach Club", canvas.width/2, canvas.height-40);

        // salva
        const link = document.createElement('a');
        link.download = 'selfie_vivi.png';
        link.href = canvas.toDataURL('image/png');
        link.click();
      };
      imgModel.src = modelSnapshot;

    } catch(err) {
      console.error("Erro ao capturar selfie:", err);
      alert("Erro ao capturar a selfie.");
    }
  });

  startCamera();

  // --- Controle pelo girosc√≥pio ---
  if (window.DeviceOrientationEvent) {
    window.addEventListener("deviceorientation", (event) => {
      let alpha = event.alpha; // eixo Z (gira em torno)
      let beta  = event.beta;  // eixo X (inclina√ß√£o frente/tr√°s)

      if (alpha !== null && beta !== null) {
        // gira horizontal pelo alpha, e limita vertical pelo beta
        modelViewer.cameraOrbit = `${alpha}deg ${90 - beta}deg auto`;
      }
    }, true);
  } else {
    console.log("Dispositivo n√£o suporta girosc√≥pio.");
  }
</script>

</body>
</html>




